# نظام تسجيل الدخول التلقائي - تطبيق غسيل السيارات للمزودين

## 🎯 نظرة عامة
تم تفعيل خاصية **"تذكرني"** في تطبيق `car_wash_provider` بحيث لا يحتاج المستخدم إلى تسجيل الدخول في كل مرة يفتح فيها التطبيق.

## ✨ الميزات الجديدة

### 🔐 حفظ بيانات المستخدم تلقائياً
- **التوكن**: يتم حفظ توكن المصادقة محلياً
- **البريد الإلكتروني**: يتم حفظ بريد المستخدم
- **الدور**: يتم حفظ دور المستخدم (مزود الخدمة)

### 🔍 فحص تلقائي للصلاحية
- **عند فتح التطبيق**: يتم التحقق من وجود توكن محفوظ
- **التحقق من الصلاحية**: يتم التأكد من صلاحية التوكن مع الخادم
- **التوجيه الذكي**: يتم توجيه المستخدم للشاشة المناسبة

### 🚪 تسجيل خروج آمن
- **حذف البيانات**: يتم حذف جميع البيانات المحفوظة
- **العودة للبداية**: العودة لشاشة تسجيل الدخول

## 🚀 كيفية العمل

### 📱 عند فتح التطبيق:
1. **شاشة البداية** ← تظهر لمدة ثانيتين
2. **فحص التوكن** ← البحث عن توكن محفوظ
3. **التحقق من الصلاحية** ← التأكد من صلاحية التوكن
4. **التوجيه**:
   - ✅ **التوكن صالح** → الشاشة الرئيسية
   - ❌ **التوكن غير صالح** → شاشة تسجيل الدخول

### 🔑 عند تسجيل الدخول:
1. **إدخال البيانات** ← البريد الإلكتروني + كلمة المرور
2. **إرسال الطلب** ← للخادم
3. **استقبال التوكن** ← من الخادم
4. **حفظ البيانات** ← محلياً
5. **الانتقال** ← للشاشة الرئيسية

### 🚪 عند تسجيل الخروج:
1. **حذف البيانات** ← جميع البيانات المحفوظة
2. **العودة** ← لشاشة تسجيل الدخول

## 🛠️ الملفات المحدثة

### 📁 ملفات جديدة:
- `lib/services/auth_service.dart` ← خدمة إدارة المصادقة
- `lib/services/token_validation_service.dart` ← خدمة التحقق من التوكن

### 📝 ملفات محدثة:
- `lib/screens/splash_screen.dart` ← شاشة البداية مع فحص تلقائي
- `lib/screens/login_screen.dart` ← شاشة تسجيل الدخول مع حفظ البيانات
- `lib/screens/main_provider_screen.dart` ← الشاشة الرئيسية مع تسجيل الخروج المحسن

## 🔒 الأمان

### ✅ ميزات الأمان:
- **التحقق من الصلاحية**: فحص التوكن مع الخادم
- **حذف تلقائي**: حذف البيانات عند انتهاء الصلاحية
- **تشفير محلي**: استخدام `SharedPreferences` لحفظ البيانات

### ⚠️ عند انتهاء صلاحية التوكن:
1. يتم حذف التوكن تلقائياً
2. يتم توجيه المستخدم لشاشة تسجيل الدخول
3. لا يمكن الوصول للبيانات المحمية

## 💻 للمطورين

### 🔧 استخدام الخدمات:
```dart
// التحقق من حالة تسجيل الدخول
final isLoggedIn = await AuthService.isLoggedIn();

// الحصول على التوكن
final token = await AuthService.getToken();

// حفظ بيانات المستخدم
await AuthService.saveUserData(
  token: 'your_token',
  email: 'user@example.com',
  role: 'provider',
);

// تسجيل الخروج
await AuthService.clearUserData();
```

### 🔍 التحقق من صلاحية التوكن:
```dart
// التحقق من صلاحية التوكن
final isValid = await TokenValidationService.isTokenStillValid(token);
```

## 👥 للمستخدمين

### 🆕 أول مرة:
- فتح التطبيق
- تسجيل الدخول بالبريد الإلكتروني وكلمة المرور
- الانتظار لحفظ البيانات

### 🔄 المرات التالية:
- فتح التطبيق مباشرة
- **لا حاجة لتسجيل الدخول** ← يتم التوجيه تلقائياً للشاشة الرئيسية

### 🚪 تسجيل الخروج:
- الضغط على أيقونة تسجيل الخروج في الشاشة الرئيسية
- العودة لشاشة تسجيل الدخول

## 📋 ملاحظات مهمة

1. **التوكن**: يتم حفظه محلياً في الجهاز
2. **الصلاحية**: يتم فحصها مع كل فتح للتطبيق
3. **الأمان**: عند انتهاء الصلاحية، يتم الحذف تلقائياً
4. **الأداء**: لا يؤثر النظام على أداء التطبيق
5. **التوافق**: يعمل مع جميع إصدارات Flutter المدعومة

## 🚨 استكشاف الأخطاء

### ❌ مشاكل شائعة:
1. **عدم حفظ التوكن**: تأكد من عمل `SharedPreferences`
2. **عدم التحقق من الصلاحية**: تأكد من اتصال الإنترنت
3. **مشاكل في التوجيه**: تأكد من وجود جميع الشاشات

### 🔧 حلول:
1. **إعادة تشغيل التطبيق**: في حالة مشاكل الذاكرة
2. **تسجيل الخروج وإعادة الدخول**: في حالة مشاكل التوكن
3. **فحص الاتصال**: تأكد من اتصال الإنترنت

## 🎉 الخلاصة

تم تفعيل نظام تسجيل الدخول التلقائي بنجاح في تطبيق `car_wash_provider` مع:

- ✅ **حفظ تلقائي** لبيانات المستخدم
- ✅ **فحص ذكي** لصلاحية التوكن
- ✅ **توجيه آمن** للشاشات المناسبة
- ✅ **حماية متقدمة** للبيانات
- ✅ **تجربة مستخدم محسنة** بدون الحاجة لتسجيل الدخول المتكرر

الآن يمكن للمستخدمين الاستمتاع بتجربة سلسة وسريعة عند استخدام التطبيق! 🚀
