# نظام تسجيل الدخول التلقائي - Car Wash Provider

## نظرة عامة
تم تفعيل خاصية "تذكرني" في تطبيق `car_wash_provider` بحيث لا يحتاج المستخدم إلى تسجيل الدخول في كل مرة يفتح فيها التطبيق.

## الميزات المضافة

### 1. خدمة المصادقة (`AuthService`)
- **حفظ بيانات المستخدم**: يحفظ التوكن والبريد الإلكتروني ودور المستخدم محلياً
- **التحقق من حالة تسجيل الدخول**: يتحقق من وجود توكن صالح
- **استرجاع البيانات**: يسترجع التوكن وبيانات المستخدم المحفوظة
- **تسجيل الخروج**: يحذف جميع البيانات المحفوظة

### 2. خدمة التحقق من التوكن (`TokenValidationService`)
- **التحقق من صلاحية التوكن**: يتحقق من صلاحية التوكن مع الخادم
- **التحقق المستمر**: يتحقق من أن التوكن لا يزال صالحاً

### 3. شاشة البداية (`SplashScreen`)
- **فحص تلقائي**: تتحقق تلقائياً من حالة تسجيل الدخول
- **التحقق من صلاحية التوكن**: تتحقق من صلاحية التوكن مع الخادم
- **التوجيه الذكي**: توجه المستخدم للشاشة المناسبة بناءً على حالة تسجيل الدخول

## كيفية العمل

### عند فتح التطبيق:
1. **شاشة البداية**: تظهر لمدة ثانيتين
2. **فحص التوكن**: تتحقق من وجود توكن محفوظ
3. **التحقق من الصلاحية**: تتحقق من صلاحية التوكن مع الخادم
4. **التوجيه**:
   - إذا كان التوكن صالح → الشاشة الرئيسية
   - إذا كان التوكن غير صالح أو غير موجود → شاشة تسجيل الدخول

### عند تسجيل الدخول:
1. **إرسال البيانات**: يتم إرسال البريد الإلكتروني وكلمة المرور
2. **استقبال التوكن**: يتم استقبال التوكن من الخادم
3. **حفظ البيانات**: يتم حفظ التوكن وبيانات المستخدم محلياً
4. **التوجيه**: الانتقال إلى الشاشة الرئيسية

### عند تسجيل الخروج:
1. **حذف البيانات**: يتم حذف جميع البيانات المحفوظة
2. **التوجيه**: العودة إلى شاشة تسجيل الدخول

## الملفات المحدثة

### ملفات جديدة:
- `lib/services/auth_service.dart` - خدمة إدارة المصادقة
- `lib/services/token_validation_service.dart` - خدمة التحقق من التوكن

### ملفات محدثة:
- `lib/screens/splash_screen.dart` - شاشة البداية مع فحص تلقائي
- `lib/screens/login_screen.dart` - شاشة تسجيل الدخول مع حفظ البيانات
- `lib/screens/main_provider_screen.dart` - الشاشة الرئيسية مع تسجيل الخروج المحسن

## الأمان

### ميزات الأمان:
- **التحقق من صلاحية التوكن**: يتم التحقق من صلاحية التوكن مع الخادم
- **حذف البيانات**: يتم حذف البيانات تلقائياً عند انتهاء صلاحية التوكن
- **تشفير البيانات**: يتم استخدام `SharedPreferences` لحفظ البيانات محلياً

### عند انتهاء صلاحية التوكن:
1. يتم حذف التوكن المحفوظ تلقائياً
2. يتم توجيه المستخدم لشاشة تسجيل الدخول
3. لا يمكن الوصول للبيانات المحمية

## الاستخدام

### للمطورين:
```dart
// التحقق من حالة تسجيل الدخول
final isLoggedIn = await AuthService.isLoggedIn();

// الحصول على التوكن
final token = await AuthService.getToken();

// حفظ بيانات المستخدم
await AuthService.saveUserData(
  token: 'your_token',
  email: 'user@example.com',
  role: 'provider',
);

// تسجيل الخروج
await AuthService.clearUserData();
```

### للمستخدمين:
- **أول مرة**: تسجيل الدخول بالبريد الإلكتروني وكلمة المرور
- **المرات التالية**: فتح التطبيق مباشرة دون الحاجة لتسجيل الدخول
- **تسجيل الخروج**: الضغط على أيقونة تسجيل الخروج في الشاشة الرئيسية

## ملاحظات مهمة

1. **التوكن**: يتم حفظ التوكن محلياً في الجهاز
2. **الصلاحية**: يتم التحقق من صلاحية التوكن مع كل فتح للتطبيق
3. **الأمان**: عند انتهاء صلاحية التوكن، يتم حذفه تلقائياً
4. **الأداء**: لا يؤثر النظام على أداء التطبيق
5. **التوافق**: يعمل مع جميع إصدارات Flutter المدعومة

## استكشاف الأخطاء

### مشاكل شائعة:
1. **عدم حفظ التوكن**: تأكد من أن `SharedPreferences` يعمل بشكل صحيح
2. **عدم التحقق من الصلاحية**: تأكد من اتصال الإنترنت
3. **مشاكل في التوجيه**: تأكد من أن جميع الشاشات موجودة

### حلول:
1. **إعادة تشغيل التطبيق**: في حالة وجود مشاكل في الذاكرة
2. **تسجيل الخروج وإعادة تسجيل الدخول**: في حالة مشاكل في التوكن
3. **فحص الاتصال**: تأكد من اتصال الإنترنت للتحقق من صلاحية التوكن
